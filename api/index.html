
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation website for PatientFlow">
      
      
        <meta name="author" content="Zella King">
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../LICENSE/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>API reference - PatientFlow</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PatientFlow" class="md-header__button md-logo" aria-label="PatientFlow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PatientFlow
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/zmek/patientflow/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    zmek/patientflow
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PatientFlow" class="md-nav__button md-logo" aria-label="PatientFlow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    PatientFlow
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zmek/patientflow/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    zmek/patientflow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#patientflow" class="md-nav__link">
    <span class="md-ellipsis">
      patientflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patientflow.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
    <nav class="md-nav" aria-label="predict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand" class="md-nav__link">
    <span class="md-ellipsis">
      emergency_demand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="emergency_demand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve" class="md-nav__link">
    <span class="md-ellipsis">
      admission_in_prediction_window_using_aspirational_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="admission_in_prediction_window_using_aspirational_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_probability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_probability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--edge-case-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Edge Case Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve" class="md-nav__link">
    <span class="md-ellipsis">
      create_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve" class="md-nav__link">
    <span class="md-ellipsis">
      decay_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="decay_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve" class="md-nav__link">
    <span class="md-ellipsis">
      get_y_from_aspirational_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_y_from_aspirational_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve" class="md-nav__link">
    <span class="md-ellipsis">
      growth_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="growth_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs" class="md-nav__link">
    <span class="md-ellipsis">
      from_individual_probs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_individual_probs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs--assuming-a-predictive-model-and-test-data-are-available" class="md-nav__link">
    <span class="md-ellipsis">
      Assuming a predictive model and test data are available
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.build_expression" class="md-nav__link">
    <span class="md-ellipsis">
      build_expression
    </span>
  </a>
  
    <nav class="md-nav" aria-label="build_expression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.build_expression--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.build_expression--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression" class="md-nav__link">
    <span class="md-ellipsis">
      compute_core_expression
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_core_expression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.create_symbols" class="md-nav__link">
    <span class="md-ellipsis">
      create_symbols
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_symbols">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.create_symbols--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.create_symbols--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.expression_subs" class="md-nav__link">
    <span class="md-ellipsis">
      expression_subs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="expression_subs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.expression_subs--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.expression_subs--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist" class="md-nav__link">
    <span class="md-ellipsis">
      get_prob_dist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_prob_dist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment" class="md-nav__link">
    <span class="md-ellipsis">
      get_prob_dist_for_prediction_moment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_prob_dist_for_prediction_moment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba" class="md-nav__link">
    <span class="md-ellipsis">
      model_input_to_pred_proba
    </span>
  </a>
  
    <nav class="md-nav" aria-label="model_input_to_pred_proba">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand" class="md-nav__link">
    <span class="md-ellipsis">
      pred_proba_to_pred_demand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pred_proba_to_pred_demand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.return_coeff" class="md-nav__link">
    <span class="md-ellipsis">
      return_coeff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="return_coeff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.return_coeff--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.return_coeff--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor" class="md-nav__link">
    <span class="md-ellipsis">
      poisson_binomial_predictor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="poisson_binomial_predictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor" class="md-nav__link">
    <span class="md-ellipsis">
      PoissonBinomialPredictor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PoissonBinomialPredictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.filter_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      filter_dataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.get_weights" class="md-nav__link">
    <span class="md-ellipsis">
      get_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.specialty_of_admission" class="md-nav__link">
    <span class="md-ellipsis">
      specialty_of_admission
    </span>
  </a>
  
    <nav class="md-nav" aria-label="specialty_of_admission">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor" class="md-nav__link">
    <span class="md-ellipsis">
      SequencePredictor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SequencePredictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.time_varying_arrival_rates" class="md-nav__link">
    <span class="md-ellipsis">
      time_varying_arrival_rates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="time_varying_arrival_rates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.time_varying_arrival_rates.calculate_rates" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_rates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive" class="md-nav__link">
    <span class="md-ellipsis">
      yet_to_arrive
    </span>
  </a>
  
    <nav class="md-nav" aria-label="yet_to_arrive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive.aggregate_probabilities" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate_probabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive.convolute_distributions" class="md-nav__link">
    <span class="md-ellipsis">
      convolute_distributions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive.poisson_binom_generating_function" class="md-nav__link">
    <span class="md-ellipsis">
      poisson_binom_generating_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive.weighted_poisson_binomial" class="md-nav__link">
    <span class="md-ellipsis">
      weighted_poisson_binomial
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#patientflow" class="md-nav__link">
    <span class="md-ellipsis">
      patientflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patientflow.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
    <nav class="md-nav" aria-label="predict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand" class="md-nav__link">
    <span class="md-ellipsis">
      emergency_demand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="emergency_demand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve" class="md-nav__link">
    <span class="md-ellipsis">
      admission_in_prediction_window_using_aspirational_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="admission_in_prediction_window_using_aspirational_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_probability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_probability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--edge-case-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Edge Case Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve" class="md-nav__link">
    <span class="md-ellipsis">
      create_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve" class="md-nav__link">
    <span class="md-ellipsis">
      decay_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="decay_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve" class="md-nav__link">
    <span class="md-ellipsis">
      get_y_from_aspirational_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_y_from_aspirational_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve" class="md-nav__link">
    <span class="md-ellipsis">
      growth_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="growth_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs" class="md-nav__link">
    <span class="md-ellipsis">
      from_individual_probs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_individual_probs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs--assuming-a-predictive-model-and-test-data-are-available" class="md-nav__link">
    <span class="md-ellipsis">
      Assuming a predictive model and test data are available
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.build_expression" class="md-nav__link">
    <span class="md-ellipsis">
      build_expression
    </span>
  </a>
  
    <nav class="md-nav" aria-label="build_expression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.build_expression--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.build_expression--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression" class="md-nav__link">
    <span class="md-ellipsis">
      compute_core_expression
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_core_expression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.create_symbols" class="md-nav__link">
    <span class="md-ellipsis">
      create_symbols
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_symbols">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.create_symbols--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.create_symbols--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.expression_subs" class="md-nav__link">
    <span class="md-ellipsis">
      expression_subs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="expression_subs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.expression_subs--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.expression_subs--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist" class="md-nav__link">
    <span class="md-ellipsis">
      get_prob_dist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_prob_dist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment" class="md-nav__link">
    <span class="md-ellipsis">
      get_prob_dist_for_prediction_moment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_prob_dist_for_prediction_moment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba" class="md-nav__link">
    <span class="md-ellipsis">
      model_input_to_pred_proba
    </span>
  </a>
  
    <nav class="md-nav" aria-label="model_input_to_pred_proba">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand" class="md-nav__link">
    <span class="md-ellipsis">
      pred_proba_to_pred_demand
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pred_proba_to_pred_demand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.return_coeff" class="md-nav__link">
    <span class="md-ellipsis">
      return_coeff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="return_coeff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.return_coeff--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.from_individual_probs.return_coeff--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor" class="md-nav__link">
    <span class="md-ellipsis">
      poisson_binomial_predictor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="poisson_binomial_predictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor" class="md-nav__link">
    <span class="md-ellipsis">
      PoissonBinomialPredictor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PoissonBinomialPredictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.filter_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      filter_dataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.get_weights" class="md-nav__link">
    <span class="md-ellipsis">
      get_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.specialty_of_admission" class="md-nav__link">
    <span class="md-ellipsis">
      specialty_of_admission
    </span>
  </a>
  
    <nav class="md-nav" aria-label="specialty_of_admission">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor" class="md-nav__link">
    <span class="md-ellipsis">
      SequencePredictor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SequencePredictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.time_varying_arrival_rates" class="md-nav__link">
    <span class="md-ellipsis">
      time_varying_arrival_rates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="time_varying_arrival_rates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.time_varying_arrival_rates.calculate_rates" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_rates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive" class="md-nav__link">
    <span class="md-ellipsis">
      yet_to_arrive
    </span>
  </a>
  
    <nav class="md-nav" aria-label="yet_to_arrive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive.aggregate_probabilities" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate_probabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive.convolute_distributions" class="md-nav__link">
    <span class="md-ellipsis">
      convolute_distributions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive.poisson_binom_generating_function" class="md-nav__link">
    <span class="md-ellipsis">
      poisson_binom_generating_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patientflow.predict.emergency_demand.yet_to_arrive.weighted_poisson_binomial" class="md-nav__link">
    <span class="md-ellipsis">
      weighted_poisson_binomial
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/zmek/patientflow/edit/main/docs/api.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="api-reference">API reference</h1>


<div class="doc doc-object doc-module">



<a id="patientflow"></a>
    <div class="doc doc-contents first">

      <p>test_package</p>
<p>Part of a repo containing boilerplate code for publishing
on PyPi.</p>



  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="patientflow.predict" class="doc doc-heading">
            <code>predict</code>


</h2>

    <div class="doc doc-contents ">



  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="patientflow.predict.emergency_demand" class="doc doc-heading">
            <code>emergency_demand</code>


</h3>

    <div class="doc doc-contents ">



  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve" class="doc doc-heading">
            <code>admission_in_prediction_window_using_aspirational_curve</code>


</h4>

    <div class="doc doc-contents ">

      <p>This module provides functions to model and analyze a curve consisting of an exponential growth segment followed by an exponential decay segment. It includes functions to create the curve, calculate specific points on it, and evaluate probabilities based on its shape.</p>
<p>Its intended use is to derive the probability of a patient being admitted to a hospital within a certain elapsed time after their arrival in the Emergency Department (ED), given the hospital's aspirations for the time it takes patients to be admitted. For this purpose, two points on the curve are required as parameters:
(x1,y1) : The target proportion of patients y1 (eg 76%) who have been admitted or discharged by time x1 (eg 4 hours). It is assumed that values of y where x &lt; x1 is a growth curve grow exponentially towards x1 and that (x1,y1) the curve switches to a decay curve
(x2, y2) : The time x2 by which all but a small proportion y2 of patients have been admitted.</p>
<p>The curve is generated by the following functions:</p>
<ul>
<li>growth_curve: Calculate exponential growth at a point where x &lt; x1.</li>
<li>decay_curve: Calculate exponential decay at a point where x &gt;= x1.</li>
<li>create_curve: Generate a full curve with both growth and decay segments.</li>
</ul>
<p>The curve is applied as follows
- get_y_from_aspirational_curve: Read from the curve a value for y, the probability of being admitted, for a given moment x hours after arrival
- calculate_probability: Compute the probability of a patient being admitted by the end of a prediction window, given how much time has elapsed since their arrival.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_probability</span><span class="p">(</span><span class="n">elapsed_los_td_hrs</span><span class="p">,</span> <span class="n">prediction_window_hrs</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calculates the probability of an admission occurring within a specified prediction window after the moment of prediction, based on the patient's elapsed time in the ED prior to the moment of prediction and the length of the window</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--parameters">Parameters</h6>
<p>elapsed_los_td_hrs : float
    The elapsed time since the patient arrived at the ED.
prediction_window_hrs : float
    The duration of the prediction window after the point of prediction, for which the probability is calculated.
(x1,y1) :
    An aspirational target, expressed in the form of a point on a curve, representing a proportion of patients y1 (eg 76%) who - if the ED meets its targets - will be admitted or discharged by time x1 (eg 4 hours).
(x2,y2) :
    An aspirational target, expressed in the form of a point on a curve, representing a time x2 by which all but a small proportion y2 of patients have been admitted if the ED meets its targets.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--returns">Returns</h6>
<p>float
    The probability of the event occurring within the given prediction window.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--edge-case-handling">Edge Case Handling</h6>
<p>When elapsed_los_td_hrs is extremely high, such as values significantly greater than x2, the admission probability prior to the current time (<code>prob_admission_prior_to_now</code>) can reach 1.0 despite the curve being asymptotic. This scenario can cause computational errors when calculating the conditional probability, as it involves a division by zero. In such cases, this function directly returns a probability of 1.0, reflecting certainty of admission.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.calculate_probability--example">Example</h6>
<p>Calculate the probability that a patient, who has already been in the ED for 3 hours, will be admitted in the next 2 hours. The ED targets that 76% of patients are admitted or discharged within 4 hours, and 99% within 12 hours.</p>
<blockquote>
<blockquote>
<blockquote>
<p>calculate_probability(3, 2, 4, 0.76, 12, 0.99)</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/admission_in_prediction_window_using_aspirational_curve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_probability</span><span class="p">(</span><span class="n">elapsed_los_td_hrs</span><span class="p">,</span> <span class="n">prediction_window_hrs</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the probability of an admission occurring within a specified prediction window after the moment of prediction, based on the patient&#39;s elapsed time in the ED prior to the moment of prediction and the length of the window</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    elapsed_los_td_hrs : float</span>
<span class="sd">        The elapsed time since the patient arrived at the ED.</span>
<span class="sd">    prediction_window_hrs : float</span>
<span class="sd">        The duration of the prediction window after the point of prediction, for which the probability is calculated.</span>
<span class="sd">    (x1,y1) :</span>
<span class="sd">        An aspirational target, expressed in the form of a point on a curve, representing a proportion of patients y1 (eg 76%) who - if the ED meets its targets - will be admitted or discharged by time x1 (eg 4 hours).</span>
<span class="sd">    (x2,y2) :</span>
<span class="sd">        An aspirational target, expressed in the form of a point on a curve, representing a time x2 by which all but a small proportion y2 of patients have been admitted if the ED meets its targets.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The probability of the event occurring within the given prediction window.</span>

<span class="sd">    Edge Case Handling</span>
<span class="sd">    ------------------</span>
<span class="sd">    When elapsed_los_td_hrs is extremely high, such as values significantly greater than x2, the admission probability prior to the current time (`prob_admission_prior_to_now`) can reach 1.0 despite the curve being asymptotic. This scenario can cause computational errors when calculating the conditional probability, as it involves a division by zero. In such cases, this function directly returns a probability of 1.0, reflecting certainty of admission.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    Calculate the probability that a patient, who has already been in the ED for 3 hours, will be admitted in the next 2 hours. The ED targets that 76% of patients are admitted or discharged within 4 hours, and 99% within 12 hours.</span>

<span class="sd">    &gt;&gt;&gt; calculate_probability(3, 2, 4, 0.76, 12, 0.99)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># probability of still being in the ED now (a function of elapsed time since arrival)</span>
    <span class="n">prob_admission_prior_to_now</span> <span class="o">=</span> <span class="n">get_y_from_aspirational_curve</span><span class="p">(</span>
        <span class="n">elapsed_los_td_hrs</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span>
    <span class="p">)</span>

    <span class="c1"># prob admission when adding the prediction window added to elapsed time since arrival</span>
    <span class="n">prob_admission_by_end_of_window</span> <span class="o">=</span> <span class="n">get_y_from_aspirational_curve</span><span class="p">(</span>
        <span class="n">elapsed_los_td_hrs</span> <span class="o">+</span> <span class="n">prediction_window_hrs</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span>
    <span class="p">)</span>

    <span class="c1"># Direct return for edge cases where `prob_admission_prior_to_now` reaches 1.0</span>
    <span class="k">if</span> <span class="n">prob_admission_prior_to_now</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="c1"># Calculate conditional probability within the prediction window</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">prob_admission_by_end_of_window</span> <span class="o">-</span> <span class="n">prob_admission_prior_to_now</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
        <span class="mi">1</span> <span class="o">-</span> <span class="n">prob_admission_prior_to_now</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_curve</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">generate_values</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Generates parameters for an exponential growth and decay curve.
Optionally generates x-values and corresponding y-values across a default or specified range.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve--parameters">Parameters</h6>
<p>x1 : float
    The x-value where the curve transitions from growth to decay.
y1 : float
    The y-value at the transition point x1.
x2 : float
    The x-value defining the end of the decay curve for calculation purposes.
y2 : float
    The y-value at x2, intended to fine-tune the decay rate.
a : float, optional
    The initial value coefficient for the growth curve, defaults to 0.01.
generate_values : bool, optional
    Flag to determine whether to generate x-values and y-values for visualization purposes.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.create_curve--returns">Returns</h6>
<p>tuple
    If generate_values is False, returns (gamma, lamda, a).
    If generate_values is True, returns (gamma, lamda, a, x_values, y_values).</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/admission_in_prediction_window_using_aspirational_curve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_curve</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">generate_values</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates parameters for an exponential growth and decay curve.</span>
<span class="sd">    Optionally generates x-values and corresponding y-values across a default or specified range.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x1 : float</span>
<span class="sd">        The x-value where the curve transitions from growth to decay.</span>
<span class="sd">    y1 : float</span>
<span class="sd">        The y-value at the transition point x1.</span>
<span class="sd">    x2 : float</span>
<span class="sd">        The x-value defining the end of the decay curve for calculation purposes.</span>
<span class="sd">    y2 : float</span>
<span class="sd">        The y-value at x2, intended to fine-tune the decay rate.</span>
<span class="sd">    a : float, optional</span>
<span class="sd">        The initial value coefficient for the growth curve, defaults to 0.01.</span>
<span class="sd">    generate_values : bool, optional</span>
<span class="sd">        Flag to determine whether to generate x-values and y-values for visualization purposes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        If generate_values is False, returns (gamma, lamda, a).</span>
<span class="sd">        If generate_values is True, returns (gamma, lamda, a, x_values, y_values).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate inputs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&lt;</span> <span class="n">x2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;x1 must be less than x2&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">y1</span> <span class="o">&lt;</span> <span class="n">y2</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;y1 must be less than y2, and both must be between 0 and 1&quot;</span><span class="p">)</span>

    <span class="c1"># Constants for growth and decay</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y1</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">x1</span>
    <span class="n">lamda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">generate_values</span><span class="p">:</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">y_values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">growth_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x1</span> <span class="k">else</span> <span class="n">decay_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">lamda</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_values</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">lamda</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span>

    <span class="k">return</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">lamda</span><span class="p">,</span> <span class="n">a</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decay_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">lamda</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calculate the exponential decay value at a given x using specified parameters.
The function supports both scalar and array inputs for x.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve--parameters">Parameters</h6>
<p>x : float or np.ndarray
    The x-value(s) at which to evaluate the curve.
x1 : float
    The x-value where the growth curve transitions to the decay curve.
y1 : float
    The y-value at the transition point, where the decay curve starts.
lamda : float
    The decay rate coefficient.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.decay_curve--returns">Returns</h6>
<p>float or np.ndarray
    The y-value(s) of the decay curve at x.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/admission_in_prediction_window_using_aspirational_curve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decay_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">lamda</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the exponential decay value at a given x using specified parameters.</span>
<span class="sd">    The function supports both scalar and array inputs for x.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float or np.ndarray</span>
<span class="sd">        The x-value(s) at which to evaluate the curve.</span>
<span class="sd">    x1 : float</span>
<span class="sd">        The x-value where the growth curve transitions to the decay curve.</span>
<span class="sd">    y1 : float</span>
<span class="sd">        The y-value at the transition point, where the decay curve starts.</span>
<span class="sd">    lamda : float</span>
<span class="sd">        The decay rate coefficient.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or np.ndarray</span>
<span class="sd">        The y-value(s) of the decay curve at x.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">y1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">lamda</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_y_from_aspirational_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calculate the probability y that a patient will have been admitted by a specified x after their arrival, by reading from the aspirational curve that has been constrained to pass through points (x1, y1) and (x2, y2) with an exponential growth curve where x &lt; x1 and an exponential decay where x &lt; x2</p>
<p>The function handles scalar or array inputs for x and determines y using either an exponential growth curve (for x &lt; x1)
or an exponential decay curve (for x &gt;= x1). The curve parameters are derived to ensure the curve passes through
specified points (x1, y1) and (x2, y2).</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve--parameters">Parameters</h6>
<p>x : float or np.ndarray
    The x-coordinate(s) at which to calculate the y-value on the curve. Can be a single value or an array of values.
x1 : float
    The x-coordinate of the first key point on the curve, where the growth phase ends and the decay phase begins.
y1 : float
    The y-coordinate of the first key point (x1), representing the target proportion of patients admitted by time x1.
x2 : float
    The x-coordinate of the second key point on the curve, beyond which all but a few patients are expected to be admitted.
y2 : float
    The y-coordinate of the second key point (x2), representing the target proportion of patients admitted by time x2.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.get_y_from_aspirational_curve--returns">Returns</h6>
<p>float or np.ndarray
    The calculated y-value(s) (probability of admission) at the given x. The type of the return matches the input type
    for x (either scalar or array).</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/admission_in_prediction_window_using_aspirational_curve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_y_from_aspirational_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the probability y that a patient will have been admitted by a specified x after their arrival, by reading from the aspirational curve that has been constrained to pass through points (x1, y1) and (x2, y2) with an exponential growth curve where x &lt; x1 and an exponential decay where x &lt; x2</span>

<span class="sd">    The function handles scalar or array inputs for x and determines y using either an exponential growth curve (for x &lt; x1)</span>
<span class="sd">    or an exponential decay curve (for x &gt;= x1). The curve parameters are derived to ensure the curve passes through</span>
<span class="sd">    specified points (x1, y1) and (x2, y2).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float or np.ndarray</span>
<span class="sd">        The x-coordinate(s) at which to calculate the y-value on the curve. Can be a single value or an array of values.</span>
<span class="sd">    x1 : float</span>
<span class="sd">        The x-coordinate of the first key point on the curve, where the growth phase ends and the decay phase begins.</span>
<span class="sd">    y1 : float</span>
<span class="sd">        The y-coordinate of the first key point (x1), representing the target proportion of patients admitted by time x1.</span>
<span class="sd">    x2 : float</span>
<span class="sd">        The x-coordinate of the second key point on the curve, beyond which all but a few patients are expected to be admitted.</span>
<span class="sd">    y2 : float</span>
<span class="sd">        The y-coordinate of the second key point (x2), representing the target proportion of patients admitted by time x2.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or np.ndarray</span>
<span class="sd">        The calculated y-value(s) (probability of admission) at the given x. The type of the return matches the input type</span>
<span class="sd">        for x (either scalar or array).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gamma</span><span class="p">,</span> <span class="n">lamda</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">create_curve</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">x1</span><span class="p">,</span> <span class="n">growth_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gamma</span><span class="p">),</span> <span class="n">decay_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">lamda</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">growth_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calculate the exponential growth value at a given x using specified parameters.
The function supports both scalar and array inputs for x.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve--parameters">Parameters</h6>
<p>x : float or np.ndarray
    The x-value(s) at which to evaluate the curve.
a : float
    The coefficient that defines the starting point of the growth curve when x is 0.
gamma : float
    The growth rate coefficient of the curve.</p>
<h6 id="patientflow.predict.emergency_demand.admission_in_prediction_window_using_aspirational_curve.growth_curve--returns">Returns</h6>
<p>float or np.ndarray
    The y-value(s) of the growth curve at x.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/admission_in_prediction_window_using_aspirational_curve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">growth_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the exponential growth value at a given x using specified parameters.</span>
<span class="sd">    The function supports both scalar and array inputs for x.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float or np.ndarray</span>
<span class="sd">        The x-value(s) at which to evaluate the curve.</span>
<span class="sd">    a : float</span>
<span class="sd">        The coefficient that defines the starting point of the growth curve when x is 0.</span>
<span class="sd">    gamma : float</span>
<span class="sd">        The growth rate coefficient of the curve.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or np.ndarray</span>
<span class="sd">        The y-value(s) of the growth curve at x.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="patientflow.predict.emergency_demand.from_individual_probs" class="doc doc-heading">
            <code>from_individual_probs</code>


</h4>

    <div class="doc doc-contents ">

      <p>Emergency Demand Prediction From Patient-Level Probababilities</p>
<p>This submodule provides functions to predict demand as a probability distribution, based on inputs that are patient-level probabilities. The module uses symbolic mathematics to build and manipulate expressions dynamically, facilitating the computation of aggregate demand probabilities.</p>


<details class="dependencies" open>
  <summary>Dependencies</summary>
  <ul>
<li>numpy: Used for array and numerical operations.</li>
<li>pandas: Utilized for handling data structures like DataFrames, enabling data manipulation and analysis.</li>
<li>sympy: A Python library for symbolic mathematics, used here to dynamically create and manipulate symbolic expressions, particularly for the calculation of probabilities.</li>
</ul>
</details>      <p>Functions:
- create_symbols(n): Generates symbolic variables.
- compute_core_expression(ri, s): Computes a symbolic expression involving both symbols and constants.
- build_expression(syms, n): Constructs a cumulative product of symbolic expressions.
- expression_subs(expression, n, predictions): Substitutes numerical values into a symbolic expression.
- return_coeff(expression, i): Extracts coefficients from expanded symbolic expressions.
- model_input_to_pred_proba(model_input, model): Converts model input data into predicted probabilities.
- pred_proba_to_pred_demand(predictions_proba, weights): Aggregates probability predictions into demand predictions.
- get_prob_dist_for_prediction_moment(X_test, y_test, model, weights): Calculates predicted and actual demands for a specific date.
- get_prob_dist(snapshots_dict, X_test, y_test, model, weights): Computes probability distributions for multiple snapshot dates.</p>
<p>These functions can work with any model object as long as it provides the predict_proba method. This icludes libraries (like scikit-learn, TensorFlow, or PyTorch), which generally offer this method</p>


<details class="example-usage" open>
  <summary>Example Usage</summary>
  <h5 id="patientflow.predict.emergency_demand.from_individual_probs--assuming-a-predictive-model-and-test-data-are-available">Assuming a predictive model and test data are available</h5>
<p>snapshot_dates = ['2023-01-01', '2023-01-02']
predicted_distribution = get_prob_dist(snapshot_dates, dataset, X_test, y_test, model)
print(predicted_distribution)</p>
</details>

<details class="note" open>
  <summary>Note</summary>
  <p>This module is designed to be generic and can be adapted to various domains where probabilistic demand
prediction is applicable. Ensure that the input data and the model adhere to the expected formats and
conventions as required by the functions.</p>
</details>      <p>Author: Zella King
Date: 25.03.24
Version: 0.1</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.build_expression" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_expression</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Construct a cumulative product expression by combining individual symbolic expressions.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.build_expression--parameters">Parameters</h6>
<p>syms : iterable
    Iterable containing symbols to use in the expressions.
n : int
    The number of terms to include in the cumulative product.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.build_expression--returns">Returns</h6>
<p>Expr
    The cumulative product of the expressions.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_expression</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a cumulative product expression by combining individual symbolic expressions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    syms : iterable</span>
<span class="sd">        Iterable containing symbols to use in the expressions.</span>
<span class="sd">    n : int</span>
<span class="sd">        The number of terms to include in the cumulative product.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Expr</span>
<span class="sd">        The cumulative product of the expressions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">expression</span> <span class="o">*=</span> <span class="n">compute_core_expression</span><span class="p">(</span><span class="n">syms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">expression</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_core_expression</span><span class="p">(</span><span class="n">ri</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Compute a symbolic expression involving a basic mathematical operation with a symbol and a constant.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression--parameters">Parameters</h6>
<p>ri : float
    The constant value to substitute into the expression.
s : Symbol
    The symbolic object used in the expression.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.compute_core_expression--returns">Returns</h6>
<p>Expr
    The symbolic expression after substitution.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_core_expression</span><span class="p">(</span><span class="n">ri</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute a symbolic expression involving a basic mathematical operation with a symbol and a constant.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ri : float</span>
<span class="sd">        The constant value to substitute into the expression.</span>
<span class="sd">    s : Symbol</span>
<span class="sd">        The symbolic object used in the expression.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Expr</span>
<span class="sd">        The symbolic expression after substitution.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">core_expression</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">s</span>
    <span class="k">return</span> <span class="n">core_expression</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">r</span><span class="p">:</span> <span class="n">ri</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.create_symbols" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_symbols</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Generate a sequence of symbolic objects intended for use in mathematical expressions.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.create_symbols--parameters">Parameters</h6>
<p>n : int
    Number of symbols to create.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.create_symbols--returns">Returns</h6>
<p>tuple
    A tuple containing the generated symbolic objects.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_symbols</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a sequence of symbolic objects intended for use in mathematical expressions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int</span>
<span class="sd">        Number of symbols to create.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the generated symbolic objects.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">symbols</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;r0:</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.expression_subs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expression_subs</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Substitute values into a symbolic expression based on a mapping from symbols to predictions.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.expression_subs--parameters">Parameters</h6>
<p>expression : Expr
    The symbolic expression to perform substitution on.
n : int
    Number of symbols and corresponding predictions.
predictions : list
    List of numerical predictions to substitute.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.expression_subs--returns">Returns</h6>
<p>Expr
    The expression after performing the substitution.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">expression_subs</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Substitute values into a symbolic expression based on a mapping from symbols to predictions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expression : Expr</span>
<span class="sd">        The symbolic expression to perform substitution on.</span>
<span class="sd">    n : int</span>
<span class="sd">        Number of symbols and corresponding predictions.</span>
<span class="sd">    predictions : list</span>
<span class="sd">        List of numerical predictions to substitute.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Expr</span>
<span class="sd">        The expression after performing the substitution.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">syms</span> <span class="o">=</span> <span class="n">create_symbols</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">substitution</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="n">predictions</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">expression</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">substitution</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_prob_dist</span><span class="p">(</span><span class="n">snapshots_dict</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calculate probability distributions for each snapshot date based on given model predictions.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--parameters">Parameters</h6>
<p>snapshots_dict : dict
    A dictionary mapping snapshot dates (as datetime objects) to indices in <code>X_test</code> and <code>y_test</code>
    that correspond to the snapshots to be tested for each date.
X_test : pandas.DataFrame
    A DataFrame containing the test features for prediction.
y_test : pandas.Series
    A Series containing the true outcome values corresponding to the test features in <code>X_test</code>.
model : any
    A predictive model object with a <code>predict_proba</code> method that takes features from <code>X_test</code> and
    optionally weights, and returns a probability distribution over possible outcomes.
weights : pandas.Series, optional
    A Series containing weights for the test data points, which may influence the prediction,
    by default None. If provided, the weights should be indexed similarly to <code>X_test</code> and <code>y_test</code>.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--returns">Returns</h6>
<p>dict
    A dictionary where each key is a snapshot date and each value is the resulting probability
    distribution for that date, obtained by applying the model on the corresponding test snapshots.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist--notes">Notes</h6>
<ul>
<li>The function asserts that the length of the test features and outcomes are equal for each
  snapshot before proceeding with predictions.</li>
<li>It notifies the user of progress in processing snapshot dates, especially if there are more
  than 10 snapshot dates.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_prob_dist</span><span class="p">(</span><span class="n">snapshots_dict</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate probability distributions for each snapshot date based on given model predictions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    snapshots_dict : dict</span>
<span class="sd">        A dictionary mapping snapshot dates (as datetime objects) to indices in `X_test` and `y_test`</span>
<span class="sd">        that correspond to the snapshots to be tested for each date.</span>
<span class="sd">    X_test : pandas.DataFrame</span>
<span class="sd">        A DataFrame containing the test features for prediction.</span>
<span class="sd">    y_test : pandas.Series</span>
<span class="sd">        A Series containing the true outcome values corresponding to the test features in `X_test`.</span>
<span class="sd">    model : any</span>
<span class="sd">        A predictive model object with a `predict_proba` method that takes features from `X_test` and</span>
<span class="sd">        optionally weights, and returns a probability distribution over possible outcomes.</span>
<span class="sd">    weights : pandas.Series, optional</span>
<span class="sd">        A Series containing weights for the test data points, which may influence the prediction,</span>
<span class="sd">        by default None. If provided, the weights should be indexed similarly to `X_test` and `y_test`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary where each key is a snapshot date and each value is the resulting probability</span>
<span class="sd">        distribution for that date, obtained by applying the model on the corresponding test snapshots.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The function asserts that the length of the test features and outcomes are equal for each</span>
<span class="sd">      snapshot before proceeding with predictions.</span>
<span class="sd">    - It notifies the user of progress in processing snapshot dates, especially if there are more</span>
<span class="sd">      than 10 snapshot dates.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prob_dist_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Calculating probability distributions for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">snapshots_dict</span><span class="p">)</span><span class="si">}</span><span class="s2"> snapshot dates&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">snapshots_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This may take a minute or more&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize a counter for notifying the user every 10 snapshot dates processed</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">dt</span><span class="p">,</span> <span class="n">snaptshots_to_include</span> <span class="ow">in</span> <span class="n">snapshots_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Ensure the lengths of test features and outcomes are equal</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">snaptshots_to_include</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">y_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">snaptshots_to_include</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;Mismatch in lengths of X_test and y_test snapshots.&quot;</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prediction_moment_weights</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prediction_moment_weights</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">snaptshots_to_include</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Compute the predicted and actual demand for the current snapshot date</span>
        <span class="n">prob_dist_dict</span><span class="p">[</span><span class="n">dt</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_prob_dist_for_prediction_moment</span><span class="p">(</span>
            <span class="n">X_test</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">snaptshots_to_include</span><span class="p">],</span>
            <span class="n">y_test</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">snaptshots_to_include</span><span class="p">],</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">prediction_moment_weights</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Increment the counter and notify the user every 10 snapshot dates processed</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">snapshots_dict</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> snapshot dates&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">snapshots_dict</span><span class="p">)</span><span class="si">}</span><span class="s2"> snapshot dates&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prob_dist_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_prob_dist_for_prediction_moment</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calculate both predicted and actual demand distributions for a given date using test data.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment--parameters">Parameters</h6>
<p>X_test : array-like
    Test features for a specific snapshot date.
y_test : array-like
    Actual outcomes corresponding to the test features.
model : object
    A predictive model which should provide a <code>predict_proba</code> method.
weights : array-like, optional
    Weights to apply to the predictions for demand calculation.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.get_prob_dist_for_prediction_moment--returns">Returns</h6>
<p>dict
    A dictionary with keys 'pred_demand' and 'actual_demand' containing the predicted and actual demands
    respectively for the snapshot date. Each is presented as a DataFrame or an integer.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_prob_dist_for_prediction_moment</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate both predicted and actual demand distributions for a given date using test data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X_test : array-like</span>
<span class="sd">        Test features for a specific snapshot date.</span>
<span class="sd">    y_test : array-like</span>
<span class="sd">        Actual outcomes corresponding to the test features.</span>
<span class="sd">    model : object</span>
<span class="sd">        A predictive model which should provide a `predict_proba` method.</span>
<span class="sd">    weights : array-like, optional</span>
<span class="sd">        Weights to apply to the predictions for demand calculation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary with keys &#39;pred_demand&#39; and &#39;actual_demand&#39; containing the predicted and actual demands</span>
<span class="sd">        respectively for the snapshot date. Each is presented as a DataFrame or an integer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prediction_moment_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pred_proba</span> <span class="o">=</span> <span class="n">model_input_to_pred_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="n">pred_demand</span> <span class="o">=</span> <span class="n">pred_proba_to_pred_demand</span><span class="p">(</span><span class="n">pred_proba</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
        <span class="n">prediction_moment_dict</span><span class="p">[</span><span class="s2">&quot;pred_demand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_demand</span>
        <span class="n">prediction_moment_dict</span><span class="p">[</span><span class="s2">&quot;actual_demand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prediction_moment_dict</span><span class="p">[</span><span class="s2">&quot;pred_demand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;agg_proba&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">prediction_moment_dict</span><span class="p">[</span><span class="s2">&quot;actual_demand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">prediction_moment_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model_input_to_pred_proba</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Use a predictive model to convert model input data into predicted probabilities.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba--parameters">Parameters</h6>
<p>model_input : array-like
    The input data to the model, typically as features used for predictions.
model : object
    A model object with a <code>predict_proba</code> method that computes probability estimates.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.model_input_to_pred_proba--returns">Returns</h6>
<p>DataFrame
    A pandas DataFrame containing the predicted probabilities for the positive class,
    with one column labeled 'pred_proba'.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">model_input_to_pred_proba</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use a predictive model to convert model input data into predicted probabilities.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model_input : array-like</span>
<span class="sd">        The input data to the model, typically as features used for predictions.</span>
<span class="sd">    model : object</span>
<span class="sd">        A model object with a `predict_proba` method that computes probability estimates.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        A pandas DataFrame containing the predicted probabilities for the positive class,</span>
<span class="sd">        with one column labeled &#39;pred_proba&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">model_input</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pred_proba&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pred_proba_to_pred_demand</span><span class="p">(</span><span class="n">predictions_proba</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Aggregate individual probability predictions into predicted demand using optional weights.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand--parameters">Parameters</h6>
<p>predictions_proba : DataFrame
    A DataFrame containing the probability predictions; must have a single column named 'pred_proba'.
weights : array-like, optional
    An array of weights, of the same length as the DataFrame rows, to apply to each prediction.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.pred_proba_to_pred_demand--returns">Returns</h6>
<p>DataFrame
    A DataFrame with a single column 'agg_proba' showing the aggregated probability demand,
    indexed from 0 to n, where n is the number of predictions.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pred_proba_to_pred_demand</span><span class="p">(</span><span class="n">predictions_proba</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregate individual probability predictions into predicted demand using optional weights.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    predictions_proba : DataFrame</span>
<span class="sd">        A DataFrame containing the probability predictions; must have a single column named &#39;pred_proba&#39;.</span>
<span class="sd">    weights : array-like, optional</span>
<span class="sd">        An array of weights, of the same length as the DataFrame rows, to apply to each prediction.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        A DataFrame with a single column &#39;agg_proba&#39; showing the aggregated probability demand,</span>
<span class="sd">        indexed from 0 to n, where n is the number of predictions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions_proba</span><span class="p">)</span>
    <span class="n">local_proba</span> <span class="o">=</span> <span class="n">predictions_proba</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">local_proba</span><span class="p">[</span><span class="s2">&quot;pred_proba&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">weights</span>

    <span class="n">syms</span> <span class="o">=</span> <span class="n">create_symbols</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">build_expression</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">expression_subs</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">local_proba</span><span class="p">[</span><span class="s2">&quot;pred_proba&quot;</span><span class="p">])</span>
    <span class="n">pred_demand_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">return_coeff</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
    <span class="n">pred_demand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
        <span class="n">pred_demand_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;agg_proba&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">pred_demand</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.from_individual_probs.return_coeff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">return_coeff</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Extract the coefficient of a specified power from an expanded symbolic expression.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.return_coeff--parameters">Parameters</h6>
<p>expression : Expr
    The expression to expand and extract from.
i : int
    The power of the term whose coefficient is to be extracted.</p>
<h6 id="patientflow.predict.emergency_demand.from_individual_probs.return_coeff--returns">Returns</h6>
<p>number
    The coefficient of the specified power in the expression.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/from_individual_probs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">return_coeff</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the coefficient of a specified power from an expanded symbolic expression.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expression : Expr</span>
<span class="sd">        The expression to expand and extract from.</span>
<span class="sd">    i : int</span>
<span class="sd">        The power of the term whose coefficient is to be extracted.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    number</span>
<span class="sd">        The coefficient of the specified power in the expression.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">expand</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="o">.</span><span class="n">coeff</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="patientflow.predict.emergency_demand.poisson_binomial_predictor" class="doc doc-heading">
            <code>poisson_binomial_predictor</code>


</h4>

    <div class="doc doc-contents ">

      <p>Poisson-Binomial Admission Predictor</p>
<p>This module implements a Poisson-Binomial admission predictor to estimate the number of hospital admissions within a specified prediction window using historical admission data. It applies Poisson and binomial distributions to forecast future admissions, excluding already arrived patients. The predictor accommodates different data filters for tailored predictions across various hospital settings.</p>


<details class="dependencies" open>
  <summary>Dependencies</summary>
  <ul>
<li>pandas: For data manipulation and analysis, essential for handling the dataset used in predictions.</li>
<li>datetime: For manipulating date and time objects, crucial for time-based predictions.</li>
<li>sklearn: Utilizes BaseEstimator and TransformerMixin from scikit-learn for creating custom, interoperable predictors.</li>
<li>Custom modules:<ul>
<li>predict.emergency_demand.yet_to_arrive: Includes the Poisson-binomial generating function for prediction calculations.</li>
<li>predict.emergency_demand.admission_in_prediction_window: Calculates the probability of admission within a specified prediction window.</li>
<li>time_varying_arrival_rates: Computes time-varying arrival rates, a core component of the prediction algorithm.</li>
</ul>
</li>
</ul>
</details>

<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor" href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor">PoissonBinomialPredictor</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Predicts the number of admissions within a given prediction window based on historical data and Poisson-binomial distribution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="patientflow.predict.emergency_demand.poisson_binomial_predictor.Methods within PoissonBinomialPredictor">Methods within PoissonBinomialPredictor</span></code></td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>init</strong>(self, filters=None): Initializes the predictor with optional data filters.</li>
<li>filter_dataframe(self, df, filters): Applies filters to the dataset for targeted predictions.</li>
<li>fit(self, train_df, prediction_window, time_interval, prediction_times, json_file_path, reference_year, y=None): Trains the predictor using historical data and various parameters.</li>
<li>predict(self, prediction_context): Predicts the number of admissions using the trained model.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>This module is designed for flexibility and customization to suit different prediction needs in hospital environments.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor" class="doc doc-heading">
            <code>PoissonBinomialPredictor</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>


      <p>A class to predict an aspirational number of admissions within a specified prediction window.
This prediction does not include patients who have already arrived and is based on historical data.
The prediction uses a combination of Poisson and binomial distributions.</p>
<p>Attributes
    None</p>
<p>Methods
    <strong>init</strong>(self, filters=None): Initializes the predictor with optional filters for data categorization.
    filter_dataframe(self, df, filters): Filters the dataset based on specified criteria for targeted predictions.
    fit(self, train_df, prediction_window, time_interval, prediction_times, json_file_path, reference_year, y=None): Trains the model using historical data and prediction parameters.
    predict(self, prediction_context): Predicts the number of admissions for a given context after the model is trained.
    get_weights(self): Retrieves the model parameters computed during fitting.</p>

              <details class="quote">
                <summary>Source code in <code>src/patientflow/predict/emergency_demand/poisson_binomial_predictor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PoissonBinomialPredictor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to predict an aspirational number of admissions within a specified prediction window.</span>
<span class="sd">    This prediction does not include patients who have already arrived and is based on historical data.</span>
<span class="sd">    The prediction uses a combination of Poisson and binomial distributions.</span>

<span class="sd">    Attributes</span>
<span class="sd">        None</span>

<span class="sd">    Methods</span>
<span class="sd">        __init__(self, filters=None): Initializes the predictor with optional filters for data categorization.</span>
<span class="sd">        filter_dataframe(self, df, filters): Filters the dataset based on specified criteria for targeted predictions.</span>
<span class="sd">        fit(self, train_df, prediction_window, time_interval, prediction_times, json_file_path, reference_year, y=None): Trains the model using historical data and prediction parameters.</span>
<span class="sd">        predict(self, prediction_context): Predicts the number of admissions for a given context after the model is trained.</span>
<span class="sd">        get_weights(self): Retrieves the model parameters computed during fitting.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the PoissonBinomialPredictor with optional filters.</span>

<span class="sd">        Args:</span>
<span class="sd">            filters (dict, optional): A dictionary defining filters for different categories or specialties.</span>
<span class="sd">                                      If None or empty, no filtering will be applied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="k">if</span> <span class="n">filters</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">filter_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a set of filters to a dataframe.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pandas.DataFrame): The DataFrame to filter.</span>
<span class="sd">            filters (dict): A dictionary where keys are column names and values are the criteria or function to filter by.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.DataFrame: A filtered DataFrame.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">criteria</span><span class="p">):</span>  <span class="c1"># If the criteria is a function, apply it directly</span>
                <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">criteria</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Otherwise, assume the criteria is a value or list of values for equality check</span>
                <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">==</span> <span class="n">criteria</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">filtered_df</span>

    <span class="k">def</span> <span class="nf">_calculate_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">prediction_window</span><span class="p">,</span> <span class="n">time_interval</span><span class="p">,</span> <span class="n">prediction_times</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate parameters required for the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pandas.DataFrame): The data frame to process.</span>
<span class="sd">            prediction_window (int): The total prediction window for prediction.</span>
<span class="sd">            time_interval (int): The interval for splitting the prediction window.</span>
<span class="sd">            prediction_times (list): Times of day at which predictions are made.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Calculated lambda_t parameters organized by time of day.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ntimes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prediction_window</span> <span class="o">/</span> <span class="n">time_interval</span><span class="p">)</span>
        <span class="n">arrival_rates_dict</span> <span class="o">=</span> <span class="n">calculate_rates</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">time_interval</span><span class="p">)</span>
        <span class="n">prediction_time_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">prediction_time_</span> <span class="ow">in</span> <span class="n">prediction_times</span><span class="p">:</span>
            <span class="n">prediction_time_hr</span><span class="p">,</span> <span class="n">prediction_time_min</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">prediction_time_</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prediction_time_</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">prediction_time_</span>
            <span class="p">)</span>
            <span class="n">lambda_t</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">arrival_rates_dict</span><span class="p">[</span>
                    <span class="p">(</span>
                        <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">prediction_time_hr</span><span class="p">,</span> <span class="n">prediction_time_min</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">time_interval</span><span class="p">)</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntimes</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">prediction_time_dict</span><span class="p">[(</span><span class="n">prediction_time_hr</span><span class="p">,</span> <span class="n">prediction_time_min</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;lambda_t&quot;</span><span class="p">:</span> <span class="n">lambda_t</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">prediction_time_dict</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">train_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">prediction_window</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">time_interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">prediction_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PoissonBinomialPredictor&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the model to the training data, computing necessary parameters for future predictions.</span>

<span class="sd">        Args:</span>
<span class="sd">            train_df (pandas.DataFrame):</span>
<span class="sd">                The training dataset with historical admission data.</span>
<span class="sd">            prediction_window (int):</span>
<span class="sd">                The prediction prediction window in minutes.</span>
<span class="sd">            time_interval (int):</span>
<span class="sd">                The interval in minutes for splitting the prediction window.</span>
<span class="sd">            prediction_times (list):</span>
<span class="sd">                Times of day at which predictions are made, in hours.</span>
<span class="sd">            epsilon (float, optional):</span>
<span class="sd">                A small value representing acceptable error rate to enable calculation of the maximum value of the random variable representing number of beds.</span>
<span class="sd">            y (None, optional):</span>
<span class="sd">                Ignored, present for compatibility with scikit-learn&#39;s fit method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PoissonBinomialPredictor: The instance itself, fitted with the training data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Store prediction_window, time_interval, and any other parameters as instance variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_window</span> <span class="o">=</span> <span class="n">prediction_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">=</span> <span class="n">time_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_times</span> <span class="o">=</span> <span class="n">prediction_times</span>

        <span class="c1"># Initialize yet_to_arrive_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># If there are filters specified, calculate and store the parameters directly with the respective spec keys</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">spec</span><span class="p">,</span> <span class="n">filters</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">spec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_parameters</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filter_dataframe</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">filters</span><span class="p">),</span>
                    <span class="n">prediction_window</span><span class="p">,</span>
                    <span class="n">time_interval</span><span class="p">,</span>
                    <span class="n">prediction_times</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If there are no filters, store the parameters with a generic key, like &#39;default&#39; or &#39;unfiltered&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_parameters</span><span class="p">(</span>
                <span class="n">train_df</span><span class="p">,</span> <span class="n">prediction_window</span><span class="p">,</span> <span class="n">time_interval</span><span class="p">,</span> <span class="n">prediction_times</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Poisson Binomial Predictor trained for these times: </span><span class="si">{</span><span class="n">prediction_times</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;using prediction window of </span><span class="si">{</span><span class="n">prediction_window</span><span class="si">}</span><span class="s2"> minutes after the time of prediction&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;and time interval of </span><span class="si">{</span><span class="n">time_interval</span><span class="si">}</span><span class="s2"> minutes within the prediction window.&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The error value for prediction will be </span><span class="si">{</span><span class="n">epsilon</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To see the weights saved by this model, used the get_weights() method&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the weights computed by the fit method.</span>

<span class="sd">        Returns</span>
<span class="sd">            dict: The weights.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>

    <span class="k">def</span> <span class="nf">_find_nearest_previous_prediction_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requested_time</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the nearest previous time of day in &#39;prediction_times&#39; relative to the requested time.</span>
<span class="sd">        If the requested time is earlier than all times in &#39;prediction_times&#39;, the function returns</span>
<span class="sd">        the latest time in &#39;prediction_times&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            requested_time (tuple): The requested time as (hour, minute).</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: The closest previous time of day from &#39;prediction_times&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">requested_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">requested_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">requested_time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;%H:%M&quot;</span>
        <span class="p">)</span>
        <span class="n">closest_prediction_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prediction_times</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">prediction_time_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_time_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">prediction_time_time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;%H:%M&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">min_diff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">prediction_time_time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_times</span><span class="p">:</span>
            <span class="n">prediction_time_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_time_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">prediction_time_time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;%H:%M&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">requested_datetime</span> <span class="o">-</span> <span class="n">prediction_time_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

            <span class="c1"># If the difference is negative, it means the prediction_time_time is ahead of the requested_time,</span>
            <span class="c1"># hence we calculate the difference by considering a day&#39;s wrap around.</span>
            <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">+=</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># Add 24 hours in seconds</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">min_diff</span><span class="p">:</span>
                <span class="n">closest_prediction_time</span> <span class="o">=</span> <span class="n">prediction_time_time</span>
                <span class="n">min_diff</span> <span class="o">=</span> <span class="n">diff</span>

        <span class="k">return</span> <span class="n">closest_prediction_time</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prediction_context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predicts the number of admissions for the given context based on the fitted model.</span>

<span class="sd">        Args:</span>
<span class="sd">            prediction_context (dict): A dictionary defining the context for which predictions are to be made.</span>
<span class="sd">                                       It should specify either a general context or one based on the applied filters.</span>
<span class="sd">            x1 : float</span>
<span class="sd">                The x-coordinate of the first transition point on the aspirational curve, where the growth phase ends and the decay phase begins.</span>
<span class="sd">            y1 : float</span>
<span class="sd">                The y-coordinate of the first transition point (x1), representing the target proportion of patients admitted by time x1.</span>
<span class="sd">            x2 : float</span>
<span class="sd">                The x-coordinate of the second transition point on the curve, beyond which all but a few patients are expected to be admitted.</span>
<span class="sd">            y2 : float</span>
<span class="sd">                The y-coordinate of the second transition point (x2), representing the target proportion of patients admitted by time x2.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary with predictions for each specified context.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># theta = self.weights.get(&quot;theta&quot;, 1)  # Provide a default value or handle if missing</span>
        <span class="n">NTimes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_window</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span>
        <span class="c1"># Calculate theta, probability of admission in prediction window</span>

        <span class="c1"># for each time interval, calculate time remaining before end of window</span>
        <span class="n">time_remaining_before_end_of_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_window</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_window</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="p">)</span>

        <span class="c1"># probability of admission in that time</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">get_y_from_aspirational_curve</span><span class="p">(</span>
            <span class="n">time_remaining_before_end_of_window</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">filter_key</span><span class="p">,</span> <span class="n">filter_values</span> <span class="ow">in</span> <span class="n">prediction_context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filter_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Filter key &#39;</span><span class="si">{</span><span class="n">filter_key</span><span class="si">}</span><span class="s2">&#39; is not recognized in the model weights.&quot;</span>
                    <span class="p">)</span>

                <span class="n">prediction_time</span> <span class="o">=</span> <span class="n">filter_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prediction_time&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prediction_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No &#39;prediction_time&#39; provided for filter &#39;</span><span class="si">{</span><span class="n">filter_key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">prediction_time</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_times</span><span class="p">:</span>
                    <span class="n">original_prediction_time</span> <span class="o">=</span> <span class="n">prediction_time</span>
                    <span class="n">prediction_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_nearest_previous_prediction_time</span><span class="p">(</span>
                        <span class="n">prediction_time</span>
                    <span class="p">)</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Time of day requested of </span><span class="si">{</span><span class="n">original_prediction_time</span><span class="si">}</span><span class="s2"> was not in model training. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Reverting to predictions for </span><span class="si">{</span><span class="n">prediction_time</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>

                <span class="n">lambda_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">filter_key</span><span class="p">][</span><span class="n">prediction_time</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lambda_t&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lambda_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No &#39;lambda_t&#39; found for the time of day &#39;</span><span class="si">{</span><span class="n">prediction_time</span><span class="si">}</span><span class="s2">&#39; under filter &#39;</span><span class="si">{</span><span class="n">filter_key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                    <span class="p">)</span>

                <span class="n">predictions</span><span class="p">[</span><span class="n">filter_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">poisson_binom_generating_function</span><span class="p">(</span>
                    <span class="n">NTimes</span><span class="p">,</span> <span class="n">lambda_t</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">!s}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predictions</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

      <p>Initialize the PoissonBinomialPredictor with optional filters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>filters</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary defining filters for different categories or specialties.
                      If None or empty, no filtering will be applied.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/poisson_binomial_predictor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the PoissonBinomialPredictor with optional filters.</span>

<span class="sd">    Args:</span>
<span class="sd">        filters (dict, optional): A dictionary defining filters for different categories or specialties.</span>
<span class="sd">                                  If None or empty, no filtering will be applied.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="k">if</span> <span class="n">filters</span> <span class="k">else</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.filter_dataframe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

      <p>Apply a set of filters to a dataframe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DataFrame to filter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filters</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary where keys are column names and values are the criteria or function to filter by.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pandas.DataFrame: A filtered DataFrame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/poisson_binomial_predictor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a set of filters to a dataframe.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pandas.DataFrame): The DataFrame to filter.</span>
<span class="sd">        filters (dict): A dictionary where keys are column names and values are the criteria or function to filter by.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: A filtered DataFrame.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span>
    <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">criteria</span><span class="p">):</span>  <span class="c1"># If the criteria is a function, apply it directly</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">criteria</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Otherwise, assume the criteria is a value or list of values for equality check</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">==</span> <span class="n">criteria</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">filtered_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">prediction_window</span><span class="p">,</span> <span class="n">time_interval</span><span class="p">,</span> <span class="n">prediction_times</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

      <p>Fits the model to the training data, computing necessary parameters for future predictions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>train_df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The training dataset with historical admission data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>prediction_window</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prediction prediction window in minutes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time_interval</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interval in minutes for splitting the prediction window.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>prediction_times</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Times of day at which predictions are made, in hours.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>epsilon</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A small value representing acceptable error rate to enable calculation of the maximum value of the random variable representing number of beds.</p>
              </div>
            </td>
            <td>
                  <code>10 ** -7</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>y</code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ignored, present for compatibility with scikit-learn's fit method.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PoissonBinomialPredictor</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor" href="#patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor">PoissonBinomialPredictor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The instance itself, fitted with the training data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/poisson_binomial_predictor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">train_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">prediction_window</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">time_interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">prediction_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PoissonBinomialPredictor&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits the model to the training data, computing necessary parameters for future predictions.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_df (pandas.DataFrame):</span>
<span class="sd">            The training dataset with historical admission data.</span>
<span class="sd">        prediction_window (int):</span>
<span class="sd">            The prediction prediction window in minutes.</span>
<span class="sd">        time_interval (int):</span>
<span class="sd">            The interval in minutes for splitting the prediction window.</span>
<span class="sd">        prediction_times (list):</span>
<span class="sd">            Times of day at which predictions are made, in hours.</span>
<span class="sd">        epsilon (float, optional):</span>
<span class="sd">            A small value representing acceptable error rate to enable calculation of the maximum value of the random variable representing number of beds.</span>
<span class="sd">        y (None, optional):</span>
<span class="sd">            Ignored, present for compatibility with scikit-learn&#39;s fit method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        PoissonBinomialPredictor: The instance itself, fitted with the training data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Store prediction_window, time_interval, and any other parameters as instance variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prediction_window</span> <span class="o">=</span> <span class="n">prediction_window</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">=</span> <span class="n">time_interval</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prediction_times</span> <span class="o">=</span> <span class="n">prediction_times</span>

    <span class="c1"># Initialize yet_to_arrive_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># If there are filters specified, calculate and store the parameters directly with the respective spec keys</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">spec</span><span class="p">,</span> <span class="n">filters</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">spec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_parameters</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filter_dataframe</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">filters</span><span class="p">),</span>
                <span class="n">prediction_window</span><span class="p">,</span>
                <span class="n">time_interval</span><span class="p">,</span>
                <span class="n">prediction_times</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If there are no filters, store the parameters with a generic key, like &#39;default&#39; or &#39;unfiltered&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_parameters</span><span class="p">(</span>
            <span class="n">train_df</span><span class="p">,</span> <span class="n">prediction_window</span><span class="p">,</span> <span class="n">time_interval</span><span class="p">,</span> <span class="n">prediction_times</span>
        <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Poisson Binomial Predictor trained for these times: </span><span class="si">{</span><span class="n">prediction_times</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;using prediction window of </span><span class="si">{</span><span class="n">prediction_window</span><span class="si">}</span><span class="s2"> minutes after the time of prediction&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;and time interval of </span><span class="si">{</span><span class="n">time_interval</span><span class="si">}</span><span class="s2"> minutes within the prediction window.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The error value for prediction will be </span><span class="si">{</span><span class="n">epsilon</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To see the weights saved by this model, used the get_weights() method&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.get_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_weights</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

      <p>Returns the weights computed by the fit method.</p>
<p>Returns
    dict: The weights.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/poisson_binomial_predictor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the weights computed by the fit method.</span>

<span class="sd">    Returns</span>
<span class="sd">        dict: The weights.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="patientflow.predict.emergency_demand.poisson_binomial_predictor.PoissonBinomialPredictor.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">prediction_context</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

      <p>Predicts the number of admissions for the given context based on the fitted model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>prediction_context</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary defining the context for which predictions are to be made.
                       It should specify either a general context or one based on the applied filters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>x1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
The x-coordinate of the first transition point on the aspirational curve, where the growth phase ends and the decay phase begins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>y1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
The y-coordinate of the first transition point (x1), representing the target proportion of patients admitted by time x1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>x2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
The x-coordinate of the second transition point on the curve, beyond which all but a few patients are expected to be admitted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>y2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
The y-coordinate of the second transition point (x2), representing the target proportion of patients admitted by time x2.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with predictions for each specified context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/poisson_binomial_predictor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">prediction_context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predicts the number of admissions for the given context based on the fitted model.</span>

<span class="sd">    Args:</span>
<span class="sd">        prediction_context (dict): A dictionary defining the context for which predictions are to be made.</span>
<span class="sd">                                   It should specify either a general context or one based on the applied filters.</span>
<span class="sd">        x1 : float</span>
<span class="sd">            The x-coordinate of the first transition point on the aspirational curve, where the growth phase ends and the decay phase begins.</span>
<span class="sd">        y1 : float</span>
<span class="sd">            The y-coordinate of the first transition point (x1), representing the target proportion of patients admitted by time x1.</span>
<span class="sd">        x2 : float</span>
<span class="sd">            The x-coordinate of the second transition point on the curve, beyond which all but a few patients are expected to be admitted.</span>
<span class="sd">        y2 : float</span>
<span class="sd">            The y-coordinate of the second transition point (x2), representing the target proportion of patients admitted by time x2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary with predictions for each specified context.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># theta = self.weights.get(&quot;theta&quot;, 1)  # Provide a default value or handle if missing</span>
    <span class="n">NTimes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_window</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span>
    <span class="c1"># Calculate theta, probability of admission in prediction window</span>

    <span class="c1"># for each time interval, calculate time remaining before end of window</span>
    <span class="n">time_remaining_before_end_of_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_window</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_window</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">/</span> <span class="mi">60</span>
    <span class="p">)</span>

    <span class="c1"># probability of admission in that time</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">get_y_from_aspirational_curve</span><span class="p">(</span>
        <span class="n">time_remaining_before_end_of_window</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">filter_key</span><span class="p">,</span> <span class="n">filter_values</span> <span class="ow">in</span> <span class="n">prediction_context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filter_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Filter key &#39;</span><span class="si">{</span><span class="n">filter_key</span><span class="si">}</span><span class="s2">&#39; is not recognized in the model weights.&quot;</span>
                <span class="p">)</span>

            <span class="n">prediction_time</span> <span class="o">=</span> <span class="n">filter_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prediction_time&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prediction_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No &#39;prediction_time&#39; provided for filter &#39;</span><span class="si">{</span><span class="n">filter_key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">prediction_time</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_times</span><span class="p">:</span>
                <span class="n">original_prediction_time</span> <span class="o">=</span> <span class="n">prediction_time</span>
                <span class="n">prediction_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_nearest_previous_prediction_time</span><span class="p">(</span>
                    <span class="n">prediction_time</span>
                <span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Time of day requested of </span><span class="si">{</span><span class="n">original_prediction_time</span><span class="si">}</span><span class="s2"> was not in model training. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Reverting to predictions for </span><span class="si">{</span><span class="n">prediction_time</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

            <span class="n">lambda_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">filter_key</span><span class="p">][</span><span class="n">prediction_time</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lambda_t&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lambda_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No &#39;lambda_t&#39; found for the time of day &#39;</span><span class="si">{</span><span class="n">prediction_time</span><span class="si">}</span><span class="s2">&#39; under filter &#39;</span><span class="si">{</span><span class="n">filter_key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>

            <span class="n">predictions</span><span class="p">[</span><span class="n">filter_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">poisson_binom_generating_function</span><span class="p">(</span>
                <span class="n">NTimes</span><span class="p">,</span> <span class="n">lambda_t</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">!s}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predictions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="patientflow.predict.emergency_demand.specialty_of_admission" class="doc doc-heading">
            <code>specialty_of_admission</code>


</h4>

    <div class="doc doc-contents ">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor" class="doc doc-heading">
            <code>SequencePredictor</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code>, <code><span title="sklearn.base.TransformerMixin">TransformerMixin</span></code></p>


              <details class="quote">
                <summary>Source code in <code>src/patientflow/predict/emergency_demand/specialty_of_admission.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SequencePredictor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_var</span><span class="p">,</span> <span class="n">grouping_var</span><span class="p">,</span> <span class="n">outcome_var</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_var</span> <span class="o">=</span> <span class="n">input_var</span>  <span class="c1"># Column name for the input sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grouping_var</span> <span class="o">=</span> <span class="n">grouping_var</span>  <span class="c1"># Column name for the grouping sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span> <span class="o">=</span> <span class="n">outcome_var</span>  <span class="c1"># Column name for the outcome category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Initialize the weights attribute to store model weights</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the predictor based on training data by computing the proportion of each</span>
<span class="sd">        input variable sequence ending in specific outcome variable categories. It also handles null</span>
<span class="sd">        sequences and incorporates a default probability for sequences without explicit data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        - X: A pandas DataFrame with at least the columns specified by input_var, grouping_var, and outcome_var.</span>
<span class="sd">        - input_var: The name of the column representing the input sequence.</span>
<span class="sd">        - grouping_var: The name of the column representing the grouping sequence.</span>
<span class="sd">        - outcome_var: The name of the column representing the outcome variable.</span>

<span class="sd">        Returns</span>
<span class="sd">        - A dictionary mapping each sequence (including null sequences) to their</span>
<span class="sd">        respective probability distribution across different categories.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># derive the names of the observed specialties from the data (used later)</span>
        <span class="n">prop_keys</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="c1"># For each sequences count the number of observed categories</span>
        <span class="n">X_grouped</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_var</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">]</span>
            <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
            <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Handle null sequences by assigning them to a specific key</span>
        <span class="n">null_counts</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_var</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()][</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">]</span>
            <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
            <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="o">.</span><span class="n">T</span>
        <span class="p">)</span>
        <span class="n">null_counts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">()]</span>

        <span class="c1"># Concatenate null sequence handling</span>
        <span class="n">X_grouped</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_grouped</span><span class="p">,</span> <span class="n">null_counts</span><span class="p">])</span>

        <span class="c1"># Calculate the total number of times each grouping sequence occurred</span>
        <span class="n">row_totals</span> <span class="o">=</span> <span class="n">X_grouped</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Calculate for each grouping sequence, the proportion of ending with each observed specialty</span>
        <span class="n">proportions</span> <span class="o">=</span> <span class="n">X_grouped</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">row_totals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Calculate the probability of each grouping sequence occurring in the original data</span>
        <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;probability_of_grouping_sequence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_totals</span> <span class="o">/</span> <span class="n">row_totals</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Reweight probabilities of ending with each observed specialty</span>
        <span class="c1"># by the likelihood of each grouping sequence occurring</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">proportions</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span>
            <span class="p">:</span><span class="o">-</span><span class="mi">1</span>
        <span class="p">]:</span>  <span class="c1"># Avoid the last column which is the &#39;probability_of_grouping_sequence&#39;</span>
            <span class="n">proportions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">*=</span> <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;probability_of_grouping_sequence&quot;</span><span class="p">]</span>

        <span class="c1"># Convert final sequence to a string in order to conduct string searches on it</span>
        <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;grouping_sequence_to_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">proportions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">x</span><span class="p">)))</span>
            <span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>
        <span class="c1"># Row-wise function to return, for each input sequence,</span>
        <span class="c1"># the proportion that end up in each final sequence and thereby</span>
        <span class="c1"># the probability of it ending in any observed category</span>
        <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;prob_input_var_ends_in_observed_specialty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proportions</span><span class="p">[</span>
            <span class="s2">&quot;grouping_sequence_to_string&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string_match_input_var</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proportions</span><span class="p">,</span> <span class="n">prop_keys</span><span class="p">))</span>

        <span class="c1"># save these as weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">proportions</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span>
            <span class="s2">&quot;prob_input_var_ends_in_observed_specialty&quot;</span>
        <span class="p">]</span>

        <span class="c1"># save the input to grouping probabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_to_grouping_probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probability_of_input_to_grouping_sequence</span><span class="p">(</span>
            <span class="n">X</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_string_match_input_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_var_string</span><span class="p">,</span> <span class="n">proportions</span><span class="p">,</span> <span class="n">prop_keys</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matches a given input sequence string with grouped sequences (expressed as strings) in the dataset and aggregates</span>
<span class="sd">        their probabilities for each outcome category. This function filters the data to</span>
<span class="sd">        match only those rows where the *beginning* of the grouped sequence string</span>
<span class="sd">        matches the given input sequence string, allowing for partial matches.</span>
<span class="sd">        For instance, the sequence &#39;medical&#39; will match &#39;medical, elderly&#39; and &#39;medical, surgical&#39;</span>
<span class="sd">        as well as &#39;medical&#39; on its own. It computes the total probabilities of any input sequence ending</span>
<span class="sd">        in each outcome category, and normalizes these totals if possible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        - input_var_string (str): The sequence of inputs represented as a string,</span>
<span class="sd">        used to match against sequences in the proportions DataFrame.</span>
<span class="sd">        - proportions (pd.DataFrame): DataFrame containing proportions data with an additional</span>
<span class="sd">        column &#39;grouping_sequence_to_string&#39; which includes string representations of sequences.</span>
<span class="sd">        - prop_keys (np.array): Array of unique outcomes to consider in calculations.</span>

<span class="sd">        Returns</span>
<span class="sd">        - dict: A dictionary where keys are outcome names and values are the aggregated</span>
<span class="sd">        and normalized probabilities of an input sequence ending in those outcomes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Filter rows where the grouped sequence string starts with the input sequence string</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">proportions</span><span class="p">[</span>
            <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;grouping_sequence_to_string&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="n">input_var_string</span><span class="p">)</span>
        <span class="p">][</span><span class="n">prop_keys</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Sum of all probabilities to normalize them</span>
        <span class="n">props_total</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Handle cases where the total probability is zero to avoid division by zero</span>
        <span class="k">if</span> <span class="n">props_total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">normalized_props</span> <span class="o">=</span> <span class="n">props</span> <span class="o">/</span> <span class="n">props_total</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">normalized_props</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">props</span> <span class="o">*</span> <span class="mi">0</span>
            <span class="p">)</span>  <span class="c1"># Returns zero probabilities if no matches found</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">prop_keys</span><span class="p">,</span> <span class="n">normalized_props</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_probability_of_input_to_grouping_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="c1"># For each input sequence count the number of grouping sequences</span>
        <span class="n">X_grouped</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_var</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_var</span><span class="p">]</span>
            <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
            <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># # Calculate the total number of times each input sequence occurred</span>
        <span class="n">row_totals</span> <span class="o">=</span> <span class="n">X_grouped</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># # Calculate for each grouping sequence, the proportion of ending with each grouping sequence</span>
        <span class="n">proportions</span> <span class="o">=</span> <span class="n">X_grouped</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">row_totals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># # Calculate the probability of each input sequence occurring in the original data</span>
        <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;probability_of_grouping_sequence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_totals</span> <span class="o">/</span> <span class="n">row_totals</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">proportions</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_sequence</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predicts the probabilities of ending in various outcome categories for a given input sequence.</span>
<span class="sd">        For example, for an input sequence such as (&quot;cardiology&quot;, &quot;orthopedics&quot;), the return</span>
<span class="sd">        value will be a dict of probabilities such as {&quot;cardiology&quot;: 0.3, &quot;orthopedics&quot;: 0.2, &quot;neurology&quot;: 0.1}.</span>

<span class="sd">        Parameters</span>
<span class="sd">        - input_sequence: A tuple containing the categories that have been observed for an entity in the order</span>
<span class="sd">        they have been encountered. An empty tuple represents an entity with no observed categories.</span>

<span class="sd">        Returns</span>
<span class="sd">        - A dictionary of categories and the probabilities that the input sequence will end in them.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check for no tuple</span>
        <span class="k">if</span> <span class="n">input_sequence</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">input_sequence</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(),</span> <span class="p">{})</span>

        <span class="c1"># Return a direct lookup of probabilities if possible.</span>
        <span class="k">if</span> <span class="n">input_sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">input_sequence</span><span class="p">]</span>

        <span class="c1"># Otherwise, if the sequence has multiple elements, work back looking for a match</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_sequence</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">input_sequence_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_sequence</span><span class="p">)</span>
            <span class="n">input_sequence</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">input_sequence_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># remove last element</span>

            <span class="k">if</span> <span class="n">input_sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">input_sequence</span><span class="p">]</span>

        <span class="c1"># If no relevant data is found:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(),</span> <span class="p">{})</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

      <p>Fits the predictor based on training data by computing the proportion of each
input variable sequence ending in specific outcome variable categories. It also handles null
sequences and incorporates a default probability for sequences without explicit data.</p>
<p>Parameters
- X: A pandas DataFrame with at least the columns specified by input_var, grouping_var, and outcome_var.
- input_var: The name of the column representing the input sequence.
- grouping_var: The name of the column representing the grouping sequence.
- outcome_var: The name of the column representing the outcome variable.</p>
<p>Returns
- A dictionary mapping each sequence (including null sequences) to their
respective probability distribution across different categories.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/specialty_of_admission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits the predictor based on training data by computing the proportion of each</span>
<span class="sd">    input variable sequence ending in specific outcome variable categories. It also handles null</span>
<span class="sd">    sequences and incorporates a default probability for sequences without explicit data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    - X: A pandas DataFrame with at least the columns specified by input_var, grouping_var, and outcome_var.</span>
<span class="sd">    - input_var: The name of the column representing the input sequence.</span>
<span class="sd">    - grouping_var: The name of the column representing the grouping sequence.</span>
<span class="sd">    - outcome_var: The name of the column representing the outcome variable.</span>

<span class="sd">    Returns</span>
<span class="sd">    - A dictionary mapping each sequence (including null sequences) to their</span>
<span class="sd">    respective probability distribution across different categories.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># derive the names of the observed specialties from the data (used later)</span>
    <span class="n">prop_keys</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="c1"># For each sequences count the number of observed categories</span>
    <span class="n">X_grouped</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_var</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">]</span>
        <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Handle null sequences by assigning them to a specific key</span>
    <span class="n">null_counts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grouping_var</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()][</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">]</span>
        <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="o">.</span><span class="n">T</span>
    <span class="p">)</span>
    <span class="n">null_counts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">()]</span>

    <span class="c1"># Concatenate null sequence handling</span>
    <span class="n">X_grouped</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_grouped</span><span class="p">,</span> <span class="n">null_counts</span><span class="p">])</span>

    <span class="c1"># Calculate the total number of times each grouping sequence occurred</span>
    <span class="n">row_totals</span> <span class="o">=</span> <span class="n">X_grouped</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Calculate for each grouping sequence, the proportion of ending with each observed specialty</span>
    <span class="n">proportions</span> <span class="o">=</span> <span class="n">X_grouped</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">row_totals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate the probability of each grouping sequence occurring in the original data</span>
    <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;probability_of_grouping_sequence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_totals</span> <span class="o">/</span> <span class="n">row_totals</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Reweight probabilities of ending with each observed specialty</span>
    <span class="c1"># by the likelihood of each grouping sequence occurring</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">proportions</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span>
        <span class="p">:</span><span class="o">-</span><span class="mi">1</span>
    <span class="p">]:</span>  <span class="c1"># Avoid the last column which is the &#39;probability_of_grouping_sequence&#39;</span>
        <span class="n">proportions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">*=</span> <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;probability_of_grouping_sequence&quot;</span><span class="p">]</span>

    <span class="c1"># Convert final sequence to a string in order to conduct string searches on it</span>
    <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;grouping_sequence_to_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">proportions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">x</span><span class="p">)))</span>
        <span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="c1"># Row-wise function to return, for each input sequence,</span>
    <span class="c1"># the proportion that end up in each final sequence and thereby</span>
    <span class="c1"># the probability of it ending in any observed category</span>
    <span class="n">proportions</span><span class="p">[</span><span class="s2">&quot;prob_input_var_ends_in_observed_specialty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proportions</span><span class="p">[</span>
        <span class="s2">&quot;grouping_sequence_to_string&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string_match_input_var</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proportions</span><span class="p">,</span> <span class="n">prop_keys</span><span class="p">))</span>

    <span class="c1"># save these as weights</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">proportions</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span>
        <span class="s2">&quot;prob_input_var_ends_in_observed_specialty&quot;</span>
    <span class="p">]</span>

    <span class="c1"># save the input to grouping probabilities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_to_grouping_probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probability_of_input_to_grouping_sequence</span><span class="p">(</span>
        <span class="n">X</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="patientflow.predict.emergency_demand.specialty_of_admission.SequencePredictor.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">input_sequence</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

      <p>Predicts the probabilities of ending in various outcome categories for a given input sequence.
For example, for an input sequence such as ("cardiology", "orthopedics"), the return
value will be a dict of probabilities such as {"cardiology": 0.3, "orthopedics": 0.2, "neurology": 0.1}.</p>
<p>Parameters
- input_sequence: A tuple containing the categories that have been observed for an entity in the order
they have been encountered. An empty tuple represents an entity with no observed categories.</p>
<p>Returns
- A dictionary of categories and the probabilities that the input sequence will end in them.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/specialty_of_admission.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_sequence</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predicts the probabilities of ending in various outcome categories for a given input sequence.</span>
<span class="sd">    For example, for an input sequence such as (&quot;cardiology&quot;, &quot;orthopedics&quot;), the return</span>
<span class="sd">    value will be a dict of probabilities such as {&quot;cardiology&quot;: 0.3, &quot;orthopedics&quot;: 0.2, &quot;neurology&quot;: 0.1}.</span>

<span class="sd">    Parameters</span>
<span class="sd">    - input_sequence: A tuple containing the categories that have been observed for an entity in the order</span>
<span class="sd">    they have been encountered. An empty tuple represents an entity with no observed categories.</span>

<span class="sd">    Returns</span>
<span class="sd">    - A dictionary of categories and the probabilities that the input sequence will end in them.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check for no tuple</span>
    <span class="k">if</span> <span class="n">input_sequence</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">input_sequence</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(),</span> <span class="p">{})</span>

    <span class="c1"># Return a direct lookup of probabilities if possible.</span>
    <span class="k">if</span> <span class="n">input_sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">input_sequence</span><span class="p">]</span>

    <span class="c1"># Otherwise, if the sequence has multiple elements, work back looking for a match</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_sequence</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">input_sequence_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_sequence</span><span class="p">)</span>
        <span class="n">input_sequence</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">input_sequence_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># remove last element</span>

        <span class="k">if</span> <span class="n">input_sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">input_sequence</span><span class="p">]</span>

    <span class="c1"># If no relevant data is found:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(),</span> <span class="p">{})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="patientflow.predict.emergency_demand.time_varying_arrival_rates" class="doc doc-heading">
            <code>time_varying_arrival_rates</code>


</h4>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.time_varying_arrival_rates.calculate_rates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_rates</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">time_interval</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calculate the time-varying arrival rates for a dataset indexed by datetime.</p>
<p>This function computes the arrival rates for each time interval specified, across the entire date range present in the dataframe. The arrival rate is calculated as the number of entries in the dataframe for each time interval, divided by the number of days in the dataset's timespan.</p>
<p>Parameters
df (pandas.DataFrame): A DataFrame indexed by datetime, representing the data for which arrival rates are to be calculated. The index of the DataFrame should be of datetime type.
time_interval (int): The time interval, in minutes, for which the arrival rates are to be calculated. For example, if <code>time_interval=60</code>, the function will calculate hourly arrival rates.</p>
<p>Returns
dict: A dictionary where the keys are the start times of each interval (as <code>datetime.time</code> objects), and the values are the corresponding arrival rates (as floats).</p>
<p>Raises
TypeError: If the index of the DataFrame is not a datetime index.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/time_varying_arrival_rates.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_rates</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">time_interval</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the time-varying arrival rates for a dataset indexed by datetime.</span>

<span class="sd">    This function computes the arrival rates for each time interval specified, across the entire date range present in the dataframe. The arrival rate is calculated as the number of entries in the dataframe for each time interval, divided by the number of days in the dataset&#39;s timespan.</span>

<span class="sd">    Parameters</span>
<span class="sd">    df (pandas.DataFrame): A DataFrame indexed by datetime, representing the data for which arrival rates are to be calculated. The index of the DataFrame should be of datetime type.</span>
<span class="sd">    time_interval (int): The time interval, in minutes, for which the arrival rates are to be calculated. For example, if `time_interval=60`, the function will calculate hourly arrival rates.</span>

<span class="sd">    Returns</span>
<span class="sd">    dict: A dictionary where the keys are the start times of each interval (as `datetime.time` objects), and the values are the corresponding arrival rates (as floats).</span>

<span class="sd">    Raises</span>
<span class="sd">    TypeError: If the index of the DataFrame is not a datetime index.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate that the DataFrame index is a datetime object</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The DataFrame index must be a DatetimeIndex.&quot;</span><span class="p">)</span>

    <span class="c1"># Determine the start and end date of the data</span>
    <span class="n">start_dt</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">end_dt</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="c1"># Convert start and end times to datetime if they are not already</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="n">start_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S%z&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_dt</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="n">end_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_dt</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S%z&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate the total number of days covered by the dataset</span>
    <span class="n">num_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_dt</span> <span class="o">-</span> <span class="n">start_dt</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Calculating time-varying arrival rates for data provided, which spans </span><span class="si">{</span><span class="n">num_days</span><span class="si">}</span><span class="s2"> days&quot;</span>
    <span class="p">)</span>

    <span class="n">arrival_rates_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Initialize a time object to iterate through one day in the specified intervals</span>
    <span class="n">_start_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">_stop_datetime</span> <span class="o">=</span> <span class="n">_start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Iterate over each interval in a single day to calculate the arrival rate</span>
    <span class="k">while</span> <span class="n">_start_datetime</span> <span class="o">!=</span> <span class="n">_stop_datetime</span><span class="p">:</span>
        <span class="n">_start_time</span> <span class="o">=</span> <span class="n">_start_datetime</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">_end_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">_start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">time_interval</span><span class="p">))</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Filter the dataframe for entries within the current time interval</span>
        <span class="n">_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">between_time</span><span class="p">(</span><span class="n">_start_time</span><span class="p">,</span> <span class="n">_end_time</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate and store the arrival rate for the interval</span>
        <span class="n">arrival_rates_dict</span><span class="p">[</span><span class="n">_start_time</span><span class="p">]</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_days</span>

        <span class="c1"># Move to the next interval</span>
        <span class="n">_start_datetime</span> <span class="o">=</span> <span class="n">_start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">time_interval</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arrival_rates_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="patientflow.predict.emergency_demand.yet_to_arrive" class="doc doc-heading">
            <code>yet_to_arrive</code>


</h4>

    <div class="doc doc-contents ">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.yet_to_arrive.aggregate_probabilities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregate_probabilities</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">time_index</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Aggregate probabilities for a range of values using the weighted Poisson-Binomial distribution.</p>
<p>Parameters
lam (numpy.ndarray): An array of lambda values for each time interval.
kmax (int): The maximum number of events to consider.
theta (numpy.ndarray): An array of theta values for each time interval.
time_index (int): The current time index for which to calculate probabilities.</p>
<p>Returns
numpy.ndarray: Aggregated probabilities for the given time index.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/yet_to_arrive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggregate_probabilities</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">time_index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregate probabilities for a range of values using the weighted Poisson-Binomial distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    lam (numpy.ndarray): An array of lambda values for each time interval.</span>
<span class="sd">    kmax (int): The maximum number of events to consider.</span>
<span class="sd">    theta (numpy.ndarray): An array of theta values for each time interval.</span>
<span class="sd">    time_index (int): The current time index for which to calculate probabilities.</span>

<span class="sd">    Returns</span>
<span class="sd">    numpy.ndarray: Aggregated probabilities for the given time index.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">kmax</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">time_index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">time_index</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">time_index</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid kmax, time_index, or array lengths.&quot;</span><span class="p">)</span>

    <span class="n">probabilities_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">kmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">probabilities_matrix</span><span class="p">[:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">weighted_poisson_binomial</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">lam</span><span class="p">[</span><span class="n">time_index</span><span class="p">],</span> <span class="n">theta</span><span class="p">[</span><span class="n">time_index</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">probabilities_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.yet_to_arrive.convolute_distributions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convolute_distributions</span><span class="p">(</span><span class="n">dist_a</span><span class="p">,</span> <span class="n">dist_b</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Convolutes two probability distributions represented as dataframes.</p>
<p>Parameters
dist_a (pd.DataFrame): The first distribution with columns ['sum', 'prob'].
dist_b (pd.DataFrame): The second distribution with columns ['sum', 'prob'].</p>
<p>Returns
pd.DataFrame: The convoluted distribution.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/yet_to_arrive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convolute_distributions</span><span class="p">(</span><span class="n">dist_a</span><span class="p">,</span> <span class="n">dist_b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convolutes two probability distributions represented as dataframes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    dist_a (pd.DataFrame): The first distribution with columns [&#39;sum&#39;, &#39;prob&#39;].</span>
<span class="sd">    dist_b (pd.DataFrame): The second distribution with columns [&#39;sum&#39;, &#39;prob&#39;].</span>

<span class="sd">    Returns</span>
<span class="sd">    pd.DataFrame: The convoluted distribution.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">{</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;prob&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">dist_a</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">{</span>
        <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
    <span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">dist_b</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrames must contain &#39;sum&#39; and &#39;prob&#39; columns.&quot;</span><span class="p">)</span>

    <span class="n">sums</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dist_a</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dist_b</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]]</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dist_a</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dist_b</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sums</span><span class="p">,</span> <span class="n">probs</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;prob&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;sum&quot;</span><span class="p">)[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.yet_to_arrive.poisson_binom_generating_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">poisson_binom_generating_function</span><span class="p">(</span><span class="n">NTimes</span><span class="p">,</span> <span class="n">lambda_t</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Generate a distribution based on the aggregate of Poisson and Binomial distributions over time intervals.</p>
<p>Parameters
NTimes (int): The number of time intervals.
lambda_t (numpy.ndarray): An array of lambda values for each time interval.
theta (numpy.ndarray): An array of theta values for each time interval.
epsilon (float): The desired error threshold.</p>
<p>Returns
pd.DataFrame: The generated distribution.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/yet_to_arrive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">poisson_binom_generating_function</span><span class="p">(</span><span class="n">NTimes</span><span class="p">,</span> <span class="n">lambda_t</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a distribution based on the aggregate of Poisson and Binomial distributions over time intervals.</span>

<span class="sd">    Parameters</span>
<span class="sd">    NTimes (int): The number of time intervals.</span>
<span class="sd">    lambda_t (numpy.ndarray): An array of lambda values for each time interval.</span>
<span class="sd">    theta (numpy.ndarray): An array of theta values for each time interval.</span>
<span class="sd">    epsilon (float): The desired error threshold.</span>

<span class="sd">    Returns</span>
<span class="sd">    pd.DataFrame: The generated distribution.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">NTimes</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">epsilon</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">epsilon</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Ensure NTimes &gt; 0 and 0 &lt; epsilon &lt; 1.&quot;</span><span class="p">)</span>

    <span class="n">maxlam</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lambda_t</span><span class="p">)</span>
    <span class="n">kmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">poisson</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">maxlam</span><span class="p">))</span>
    <span class="n">distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">kmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NTimes</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NTimes</span><span class="p">):</span>
        <span class="n">distribution</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">aggregate_probabilities</span><span class="p">(</span><span class="n">lambda_t</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

    <span class="n">df_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="n">distribution</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]})</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NTimes</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">total_distribution</span> <span class="o">=</span> <span class="n">df_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">total_distribution</span> <span class="o">=</span> <span class="n">convolute_distributions</span><span class="p">(</span><span class="n">total_distribution</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

    <span class="n">total_distribution</span> <span class="o">=</span> <span class="n">total_distribution</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="s2">&quot;agg_proba&quot;</span><span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">total_distribution</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="patientflow.predict.emergency_demand.yet_to_arrive.weighted_poisson_binomial" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">weighted_poisson_binomial</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

      <p>Calculate weighted probabilities using Poisson and Binomial distributions.</p>
<p>Parameters
i (int): The upper bound of the range for the binomial distribution.
lam (float): The lambda parameter for the Poisson distribution.
theta (float): The probability of success for the binomial distribution.</p>
<p>Returns
numpy.ndarray: An array of weighted probabilities.</p>

            <details class="quote">
              <summary>Source code in <code>src/patientflow/predict/emergency_demand/yet_to_arrive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">weighted_poisson_binomial</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate weighted probabilities using Poisson and Binomial distributions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    i (int): The upper bound of the range for the binomial distribution.</span>
<span class="sd">    lam (float): The lambda parameter for the Poisson distribution.</span>
<span class="sd">    theta (float): The probability of success for the binomial distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    numpy.ndarray: An array of weighted probabilities.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lam</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">theta</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Ensure i &gt;= 0, lam &gt;= 0, and 0 &lt;= theta &lt;= 1.&quot;</span><span class="p">)</span>

    <span class="n">arr_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">binom</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">arr_seq</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span> <span class="o">*</span> <span class="n">probabilities</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2024 Zella King
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/zmek" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>